<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategische Immobilienbewertung | SW Immobilien</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root {
            --primary: #1a2332;
            --secondary: #2c3e50;
            --accent: #c9a961;
            --gold: #d4af37;
            --cta: #c7463f;
            --bg: #ffffff;
            --card-bg: #f8f9fa;
            --border: #d1d5db;
            --text-primary: #1a1a1a;
            --text-secondary: #6b7280;
        }

        * { box-sizing: border-box; }
        body { 
            margin: 0; 
            background: #f5f7fa; 
            font-family: 'Inter', sans-serif; 
            color: var(--text-primary); 
            font-size: 15px; 
            scroll-behavior: smooth;
            line-height: 1.6;
        }
        .app-wrapper { 
            max-width: 920px; 
            margin: 30px auto; 
            padding: 0; 
            background: #fff; 
            border-radius: 8px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        /* PREMIUM TYPOGRAPHY */
        h1 { 
            font-family: 'Playfair Display', serif; 
            font-size: 38px; 
            color: var(--primary); 
            margin: 0 0 15px 0; 
            line-height: 1.2; 
            font-weight: 800; 
            letter-spacing: -0.5px;
        }
        h2 { 
            font-family: 'Playfair Display', serif; 
            font-size: 28px; 
            color: var(--primary); 
            margin: 0 0 25px 0; 
            font-weight: 700; 
            letter-spacing: -0.3px;
        }
        h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
            margin: 0 0 15px 0;
        }

        .manufaktur-label { 
            color: var(--accent); 
            font-weight: 600; 
            font-size: 11px; 
            text-transform: uppercase; 
            letter-spacing: 1.5px; 
            margin-bottom: 12px; 
            display: inline-block;
        }

        /* STICKY CTA BUTTON */
        .sticky-cta { 
            position: fixed; 
            bottom: 30px; 
            right: 30px; 
            background: var(--cta); 
            color: white; 
            padding: 18px 32px; 
            border-radius: 6px; 
            font-weight: 700; 
            font-size: 15px; 
            box-shadow: 0 8px 25px rgba(199, 70, 63, 0.35); 
            cursor: pointer; 
            z-index: 9999; 
            display: none; 
            animation: pulse 2s infinite; 
            border: none;
            transition: all 0.3s ease;
        }
        .sticky-cta.visible { display: block; }
        .sticky-cta:hover { 
            background: #b33b35; 
            transform: translateY(-2px); 
            box-shadow: 0 12px 35px rgba(199, 70, 63, 0.4);
        }
        @keyframes pulse { 
            0%, 100% { box-shadow: 0 8px 25px rgba(199, 70, 63, 0.35); } 
            50% { box-shadow: 0 8px 35px rgba(199, 70, 63, 0.5); } 
        }

        /* EXIT INTENT MODAL */
        .exit-modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.85); 
            z-index: 10000; 
            align-items: center; 
            justify-content: center; 
        }
        .exit-modal.show { display: flex; }
        .exit-content { 
            background: white; 
            padding: 50px; 
            border-radius: 8px; 
            max-width: 550px; 
            text-align: center; 
            position: relative; 
            animation: slideDown 0.4s ease; 
        }
        @keyframes slideDown { 
            from { opacity: 0; transform: translateY(-50px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        .exit-close { 
            position: absolute; 
            top: 15px; 
            right: 20px; 
            font-size: 32px; 
            cursor: pointer; 
            color: #999; 
            font-weight: 300;
            line-height: 1;
        }

        /* INTRO SECTION */
        .intro-section {
            position: relative;
            padding: 50px;
            background: linear-gradient(135deg, #1a2332 0%, #2c3e50 100%);
        }
        .intro-grid { 
            display: flex; 
            gap: 40px; 
            align-items: center; 
        }
        .intro-text-side { 
            flex: 1.3; 
            color: white;
        }
        .intro-text-side h1 {
            color: white;
        }
        .intro-text-side p {
            color: rgba(255,255,255,0.9);
            font-size: 16px;
            line-height: 1.7;
        }
        .intro-image-side { 
            flex: 0.7; 
            position: relative;
        }
        .intro-image-wrapper {
            position: relative;
        }
        .intro-image {
            width: 100%;
            height: 360px;
            background: url('https://sw-immobilien.de/wp-content/uploads/2026/01/dennis-will-immobilien.jpg') center/cover;
            border-radius: 6px;
        }
        .trust-badges-overlay {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            padding: 15px 25px;
            border-radius: 6px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .trust-badges-overlay img {
            height: 50px;
            object-fit: contain;
        }

        /* BUTTONS */
        .btn-main { 
            background: var(--cta); 
            color: white; 
            border: none; 
            padding: 18px 32px; 
            border-radius: 6px; 
            font-weight: 700; 
            cursor: pointer; 
            width: 100%; 
            font-size: 16px; 
            transition: 0.3s;
            font-family: 'Inter', sans-serif;
        }
        .btn-main:hover { 
            background: #b33b35; 
            transform: translateY(-2px); 
            box-shadow: 0 6px 20px rgba(199, 70, 63, 0.3); 
        }
        .btn-outline { 
            background: transparent; 
            border: 2px solid rgba(255,255,255,0.3); 
            color: white; 
            padding: 16px 32px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-weight: 600; 
            width: 100%; 
            margin-top: 12px; 
            transition: 0.3s;
            font-size: 15px;
        }
        .btn-outline:hover { 
            border-color: white; 
            background: rgba(255,255,255,0.1);
        }
        .btn-outline-dark {
            background: white;
            border: 2px solid var(--border);
            color: var(--text-secondary);
            padding: 14px 28px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            width: 100%;
            margin-top: 12px;
            transition: 0.3s;
        }
        .btn-outline-dark:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* CONTENT PADDING */
        .step-content {
            padding: 50px;
        }

        /* GRID & CARDS */
        .grid-options { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
            gap: 15px; 
            margin: 25px 0; 
        }
        .card-option { 
            background: white; 
            border: 2px solid var(--border); 
            padding: 28px 20px; 
            border-radius: 6px; 
            text-align: center; 
            cursor: pointer; 
            transition: 0.2s; 
            position: relative;
            font-weight: 600;
            color: var(--text-primary);
        }
        .card-option:hover { 
            border-color: var(--accent); 
            transform: translateY(-3px); 
            box-shadow: 0 6px 20px rgba(0,0,0,0.08); 
        }
        .card-option.selected { 
            border-color: var(--accent); 
            background: #fefcf5; 
            box-shadow: 0 6px 20px rgba(201, 169, 97, 0.15); 
        }
        .card-option-icon {
            font-size: 36px;
            margin-bottom: 12px;
            line-height: 1;
        }
        
        /* BADGE WITH MINUS FUNCTION */
        .badge { 
            position: absolute; 
            top: -12px; 
            right: -12px; 
            background: var(--accent); 
            color: white; 
            width: 32px; 
            height: 32px; 
            border-radius: 50%; 
            font-size: 14px; 
            font-weight: 700; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            border: 3px solid white; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.15); 
            cursor: pointer;
            transition: 0.2s;
        }
        .badge:hover { 
            background: var(--cta); 
            transform: scale(1.1);
        }
        .badge-minus {
            position: absolute;
            top: -12px;
            left: -12px;
            background: var(--text-secondary);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            cursor: pointer;
            transition: 0.2s;
            line-height: 1;
        }
        .badge-minus:hover {
            background: var(--cta);
            transform: scale(1.1);
        }

        /* INPUTS & SLIDERS */
        .input-group { 
            margin-bottom: 30px; 
        }
        .flex-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 12px; 
        }
        .flex-header label {
            font-weight: 600;
            color: var(--text-primary);
        }
        .num-box { 
            width: 90px; 
            padding: 10px 12px; 
            border: 2px solid var(--border); 
            border-radius: 6px; 
            text-align: center; 
            font-weight: 800; 
            color: var(--primary); 
            font-size: 16px;
            font-family: 'Inter', sans-serif;
        }
        input[type="range"] { 
            width: 100%; 
            height: 6px; 
            accent-color: var(--accent); 
            border-radius: 3px; 
        }
        input[type="text"] {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border);
            border-radius: 6px;
            font-size: 15px;
            font-family: 'Inter', sans-serif;
            transition: 0.2s;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: var(--accent);
        }

        /* SOCIAL PROOF */
        .social-proof { 
            background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%); 
            color: var(--text-primary); 
            padding: 35px; 
            border-radius: 6px; 
            margin: 35px 0; 
            text-align: center; 
        }
        .social-proof-header {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--primary);
        }
        .social-proof-subtext {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 25px;
        }
        .social-proof-date {
            display: inline-block;
            background: rgba(0,0,0,0.05);
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }
        .testimonial-slider { 
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        .testimonial { 
            background: white; 
            padding: 25px; 
            border-radius: 6px;
            text-align: left;
            border-left: 4px solid var(--accent);
        }
        .testimonial-text { 
            font-size: 14px; 
            font-style: italic; 
            margin-bottom: 12px;
            color: var(--text-primary);
            line-height: 1.6;
        }
        .testimonial-author { 
            font-size: 13px; 
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* RESULT CARDS */
        .result-card { 
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); 
            color: white; 
            padding: 50px 40px; 
            border-radius: 6px; 
            text-align: center; 
            margin-bottom: 30px; 
            position: relative; 
            overflow: hidden; 
        }
        .result-card-label {
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            opacity: 0.8;
            margin-bottom: 15px;
            font-weight: 600;
        }
        .result-card-value {
            font-family: 'Playfair Display', serif;
            font-size: 52px;
            font-weight: 800;
            margin: 15px 0;
            letter-spacing: -1px;
        }
        .result-card-subtext {
            opacity: 0.85;
            font-size: 15px;
        }
        
        /* WARNING BOX */
        .warning-box { 
            background: #fef9ed; 
            border-left: 4px solid var(--gold); 
            padding: 30px; 
            border-radius: 6px; 
            margin: 30px 0; 
        }
        .warning-box h3 { 
            color: #92400e; 
            margin: 0 0 20px 0; 
            font-size: 18px;
            font-weight: 700;
        }
        .warning-list { 
            list-style: none; 
            padding: 0; 
            margin: 20px 0; 
        }
        .warning-list li { 
            padding: 10px 0; 
            padding-left: 30px; 
            position: relative; 
            color: #78350f; 
            font-size: 15px; 
            line-height: 1.6;
            font-weight: 500;
        }
        .warning-list li::before { 
            content: '‚ñ∏'; 
            position: absolute; 
            left: 0;
            color: var(--gold);
            font-weight: bold;
        }
        .warning-cta-box {
            background: white;
            padding: 25px;
            border-radius: 6px;
            margin-top: 25px;
            text-align: center;
        }
        .warning-cta-text {
            color: var(--primary);
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: 0.2s;
        }
        .warning-cta-text:hover {
            color: var(--accent);
        }

        /* INSIGHT CARDS */
        .insight-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); 
            gap: 20px; 
            margin: 35px 0; 
        }
        .insight-card { 
            background: white; 
            border: 2px solid var(--border); 
            border-radius: 6px; 
            padding: 30px; 
            transition: 0.3s; 
        }
        .insight-card:hover { 
            border-color: var(--accent); 
            transform: translateY(-5px); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
        }
        .insight-title { 
            font-size: 17px; 
            font-weight: 700; 
            color: var(--primary); 
            margin-bottom: 12px; 
        }
        .insight-text { 
            font-size: 14px; 
            line-height: 1.7; 
            color: var(--text-secondary); 
        }

        /* DETAILED ANALYSIS */
        .analysis-header { 
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); 
            color: white; 
            padding: 50px 40px; 
            text-align: center; 
        }
        .analysis-header h1 {
            color: white;
            margin-bottom: 12px;
        }
        .analysis-header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .analysis-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 25px; 
            margin: 35px 0; 
        }
        .analysis-card { 
            background: var(--card-bg); 
            border: 2px solid var(--border); 
            border-radius: 6px; 
            padding: 30px; 
        }
        .analysis-label { 
            font-size: 11px; 
            text-transform: uppercase; 
            color: var(--text-secondary); 
            font-weight: 600; 
            letter-spacing: 1.2px; 
            margin-bottom: 10px; 
        }
        .analysis-value { 
            font-family: 'Playfair Display', serif; 
            font-size: 36px; 
            font-weight: 800; 
            color: var(--primary); 
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }
        .analysis-sub { 
            font-size: 14px; 
            color: var(--text-secondary); 
        }

        /* CALCULATION BREAKDOWN */
        .calculation-breakdown {
            background: white;
            border: 2px solid var(--border);
            border-radius: 6px;
            padding: 30px;
            margin: 25px 0;
        }
        .breakdown-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f3f4f6;
            font-size: 15px;
        }
        .breakdown-item:last-child {
            border-bottom: none;
            padding-top: 15px;
            margin-top: 10px;
            border-top: 2px solid var(--border);
            font-weight: 700;
        }
        .breakdown-label {
            color: var(--text-secondary);
        }
        .breakdown-value {
            font-weight: 600;
            color: var(--primary);
        }

        /* BUYER DATABASE */
        .database-search { 
            background: linear-gradient(135deg, #ec4899 0%, #f43f5e 100%); 
            padding: 45px; 
            border-radius: 6px; 
            text-align: center; 
            color: white; 
            margin: 35px 0; 
            position: relative; 
        }
        .database-search h2 {
            color: white;
            margin-bottom: 15px;
        }
        .database-timer {
            display: none;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 6px;
            margin: 25px 0;
            font-size: 15px;
        }
        .database-timer.active {
            display: block;
        }
        .timer-display {
            font-family: 'Playfair Display', serif;
            font-size: 48px;
            font-weight: 800;
            margin: 15px 0;
            letter-spacing: 2px;
        }
        .timer-warning {
            font-size: 13px;
            opacity: 0.9;
            margin-top: 10px;
        }
        
        .search-animation { 
            display: none; 
            margin: 30px 0; 
        }
        .search-animation.active { 
            display: block; 
        }
        .search-spinner { 
            border: 4px solid rgba(255,255,255,0.3); 
            border-top: 4px solid white; 
            border-radius: 50%; 
            width: 60px; 
            height: 60px; 
            animation: spin 1s linear infinite; 
            margin: 20px auto; 
        }
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        
        .buyer-results { 
            display: none; 
            margin-top: 35px; 
        }
        .buyer-results.show { 
            display: block; 
            animation: fadeIn 0.6s ease; 
        }
        .buyer-results-header {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        .buyer-results-subtext {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 25px;
        }
        .buyer-progress {
            background: rgba(255,255,255,0.2);
            border-radius: 6px;
            padding: 15px 20px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .progress-text {
            font-size: 14px;
            font-weight: 600;
        }
        .progress-bar-container {
            flex: 1;
            background: rgba(255,255,255,0.3);
            height: 8px;
            border-radius: 4px;
            margin: 0 15px;
            overflow: hidden;
        }
        .progress-bar-fill {
            background: white;
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .buyer-match { 
            background: rgba(255,255,255,0.15); 
            backdrop-filter: blur(10px); 
            border-radius: 6px; 
            padding: 25px; 
            margin: 15px 0; 
            text-align: left;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .buyer-match-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        .buyer-id { 
            font-size: 11px; 
            opacity: 0.7;
            font-family: monospace;
            letter-spacing: 0.5px;
        }
        .buyer-match-score {
            background: rgba(255,255,255,0.25);
            padding: 6px 14px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 700;
        }
        .buyer-date { 
            font-size: 12px; 
            font-weight: 600;
            background: rgba(255,255,255,0.25); 
            padding: 6px 12px; 
            border-radius: 4px; 
        }
        .buyer-criteria { 
            font-size: 14px; 
            margin-top: 12px;
            line-height: 1.8;
        }
        .buyer-criteria-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
        }
        .buyer-criteria-label {
            opacity: 0.85;
        }
        .buyer-criteria-value {
            font-weight: 600;
        }
        .buyer-status {
            display: inline-block;
            background: rgba(74, 222, 128, 0.2);
            color: #dcfce7;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }

        .pagination-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 25px 0 20px 0;
        }
        .pagination-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            cursor: pointer;
            transition: 0.2s;
        }
        .pagination-dot.active {
            background: white;
            width: 30px;
            border-radius: 5px;
        }
        .pagination-dot:not(.active):hover {
            background: rgba(255,255,255,0.5);
        }

        .premium-unlock {
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 6px;
            margin-top: 25px;
            border: 2px solid rgba(255,255,255,0.3);
        }
        .unlock-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        /* MAP */
        #map { 
            height: 320px; 
            border-radius: 6px; 
            margin: 20px 0; 
            border: 2px solid var(--border); 
        }
        #addr_res {
            background: white;
            border: 2px solid var(--border);
            border-radius: 6px;
            max-height: 220px;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        .addr-result-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid var(--border);
            transition: 0.2s;
        }
        .addr-result-item:last-child {
            border-bottom: none;
        }
        .addr-result-item:hover {
            background: #f9fafb;
        }

        /* UTILS */
        .step { 
            display: none; 
        }
        .step.active { 
            display: block; 
            animation: fadeIn 0.4s ease; 
        }
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        .hidden { 
            display: none; 
        }
        .full-tooltip { 
            background: #f0f4f8; 
            border-left: 4px solid var(--accent); 
            padding: 25px; 
            border-radius: 6px; 
            margin-top: 25px; 
            font-size: 14px; 
            line-height: 1.7; 
        }
        .tooltip-cta {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }
        .tooltip-cta a {
            color: var(--cta);
            text-decoration: none;
            font-weight: 700;
        }

        .cta-box {
            margin-top: 35px;
            padding: 30px;
            background: var(--card-bg);
            border-radius: 6px;
            text-align: center;
        }
        .cta-box-text {
            color: var(--text-secondary);
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.6;
        }
        .cta-box-text strong {
            color: var(--primary);
            display: block;
            margin-bottom: 5px;
        }

        /* MOBILE RESPONSIVE */
        @media (max-width: 768px) {
            .app-wrapper { 
                margin: 10px; 
                border-radius: 6px;
            }
            .intro-section {
                padding: 30px 25px;
            }
            .intro-grid { 
                flex-direction: column;
                gap: 25px;
            }
            .intro-image {
                height: 280px;
            }
            .trust-badges-overlay {
                position: relative;
                bottom: 0;
                transform: none;
                margin-top: 20px;
            }
            .step-content {
                padding: 30px 25px;
            }
            .grid-options { 
                grid-template-columns: 1fr; 
            }
            h1 { 
                font-size: 28px; 
            }
            h2 {
                font-size: 24px;
            }
            .result-card-value {
                font-size: 38px;
            }
            .sticky-cta { 
                bottom: 15px; 
                right: 15px; 
                padding: 14px 24px; 
                font-size: 14px; 
            }
            .exit-content { 
                padding: 30px 25px; 
                margin: 20px; 
            }
            .insight-grid { 
                grid-template-columns: 1fr; 
            }
            .analysis-grid { 
                grid-template-columns: 1fr; 
            }
            .testimonial-slider { 
                grid-template-columns: 1fr; 
            }
            .timer-display {
                font-size: 36px;
            }
        }
    </style>
</head>
<body>

<!-- STICKY CTA BUTTON -->
<button class="sticky-cta" id="stickyCta" onclick="openCalendly()">
    Jetzt Termin sichern
</button>

<!-- EXIT INTENT MODAL -->
<div class="exit-modal" id="exitModal">
    <div class="exit-content">
        <span class="exit-close" onclick="closeExitModal()">√ó</span>
        <h2 style="color: var(--primary); margin-bottom: 15px;">Moment!</h2>
        <p style="font-size: 17px; margin-bottom: 25px; line-height: 1.6; color: var(--text-secondary);">
            Ihre Immobilie verdient eine <strong style="color: var(--primary);">individuelle Bewertung</strong> ‚Äì nicht nur einen Algorithmus.
        </p>
        <p style="color: var(--text-secondary); margin-bottom: 30px; font-size: 15px;">
            Sichern Sie sich jetzt ein <strong>kostenloses 15-Minuten-Strategiegespr√§ch</strong> mit unserem Experten.
        </p>
        <button class="btn-main" onclick="openCalendly(); closeExitModal();">
            Ja, Termin vereinbaren
        </button>
        <button class="btn-outline-dark" onclick="closeExitModal()">
            Sp√§ter entscheiden
        </button>
    </div>
</div>

<div class="app-wrapper">
    
    <!-- STEP 0: INTRO -->
    <div class="step active" id="step0">
        <div class="intro-section">
            <div class="intro-grid">
                <div class="intro-text-side">
                    <div class="manufaktur-label">Manufaktur statt Massenabfertigung</div>
                    <h1>Ihre Immobilie ist kein Algorithmus.</h1>
                    <p>
                        Wir bewerten pers√∂nlich & strategisch ‚Äì mit Marktkenntnis, die kein Portal bieten kann.
                    </p>
                    <button class="btn-main" onclick="openCalendly()">
                        Strategiegespr√§ch vereinbaren
                    </button>
                    <button class="btn-outline" onclick="nextStep(1)">
                        Diskrete Online-Analyse starten
                    </button>
                </div>
                <div class="intro-image-side">
                    <div class="intro-image-wrapper">
                        <div class="intro-image"></div>
                        <div class="trust-badges-overlay">
                            <img src="https://sw-immobilien.de/wp-content/uploads/2025/10/1.jpg" alt="Zertifizierung">
                            <img src="https://sw-immobilien.de/wp-content/uploads/2024/04/ImmoScout24-Siegel_Experte-200x200-1.png" alt="ImmoScout24 Experte">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- STEP 1: IMMOBILIENTYP -->
    <div class="step" id="step1">
        <div class="step-content">
            <h2>Welche Art Immobilie bewerten wir?</h2>
            <div class="grid-options">
                <div class="card-option" onclick="selectCat('haus')">
                    <div class="card-option-icon">üè†</div>
                    Haus
                </div>
                <div class="card-option" onclick="selectCat('wohnung')">
                    <div class="card-option-icon">üè¢</div>
                    Wohnung
                </div>
                <div class="card-option" onclick="selectCat('gewerbe')">
                    <div class="card-option-icon">üè≠</div>
                    Gewerbe
                </div>
                <div class="card-option" onclick="selectCat('grundstueck')">
                    <div class="card-option-icon">üå≥</div>
                    Grundst√ºck
                </div>
            </div>
            <div id="subCatWrapper" class="hidden">
                <h3 style="margin-top: 30px;">Detailauswahl:</h3>
                <div id="subCatGrid" class="grid-options"></div>
            </div>
            <button class="btn-outline-dark" onclick="nextStep(0)">‚Üê Zur√ºck</button>
        </div>
    </div>

    <!-- STEP 2: ECKDATEN -->
    <div class="step" id="step2">
        <div class="step-content">
            <h2>Eckdaten Ihrer Immobilie</h2>
            <div class="input-group">
                <div class="flex-header">
                    <label>Wohnfl√§che (m¬≤)</label>
                    <input type="number" id="num_living" class="num-box" oninput="sync('living', 'num')">
                </div>
                <input type="range" id="rng_living" min="20" max="500" value="120" oninput="sync('living', 'rng')">
            </div>
            <div class="input-group" id="plot_box">
                <div class="flex-header">
                    <label>Grundst√ºcksgr√∂√üe (m¬≤)</label>
                    <input type="number" id="num_plot" class="num-box" oninput="sync('plot', 'num')">
                </div>
                <input type="range" id="rng_plot" min="0" max="2000" value="500" oninput="sync('plot', 'rng')">
            </div>
            <div class="input-group">
                <div class="flex-header">
                    <label>Baujahr</label>
                    <input type="number" id="num_year" class="num-box" oninput="sync('year', 'num')">
                </div>
                <input type="range" id="rng_year" min="1900" max="2025" value="1995" oninput="sync('year', 'rng')">
            </div>

            <!-- SOCIAL PROOF -->
            <div class="social-proof">
                <div class="social-proof-header">√úber 340 Eigent√ºmer vertrauen uns bereits</div>
                <div class="social-proof-date">Stand: 14. Februar 2026</div>
                <div class="social-proof-subtext">Diskrete Beratung ¬∑ Faire Bewertung ¬∑ Maximaler Verkaufspreis</div>
                <div class="testimonial-slider">
                    <div class="testimonial">
                        <div class="testimonial-text">"Die Bewertung war deutlich pr√§ziser als bei ImmoScout. Der Verkauf lief reibungslos!"</div>
                        <div class="testimonial-author">‚Äî Familie M., Neustadt</div>
                    </div>
                    <div class="testimonial">
                        <div class="testimonial-text">"Kompetent, diskret und 15% √ºber dem erwarteten Preis verkauft. Vielen Dank!"</div>
                        <div class="testimonial-author">‚Äî Herr K., Landau</div>
                    </div>
                    <div class="testimonial">
                        <div class="testimonial-text">"Endlich jemand, der die Region wirklich kennt. Keine Standard-Algorithmen."</div>
                        <div class="testimonial-author">‚Äî Frau B., Speyer</div>
                    </div>
                </div>
            </div>

            <button class="btn-main" onclick="checkFlowStep2()">Weiter</button>
            <button class="btn-outline-dark" onclick="nextStep(1)">‚Üê Zur√ºck</button>
        </div>
    </div>

    <!-- STEP 3: ZUSTAND -->
    <div class="step" id="step3">
        <div class="step-content">
            <h2>Zustand der Immobilie</h2>
            <div class="grid-options">
                <div class="card-option" onclick="setSelect('cond', 'Neubau', this)">
                    <div class="card-option-icon">‚ú®</div>
                    Neubau
                </div>
                <div class="card-option" onclick="setSelect('cond', 'Modernisiert', this)">
                    <div class="card-option-icon">üîÑ</div>
                    Modernisiert
                </div>
                <div class="card-option" onclick="setSelect('cond', 'Gepflegt', this)">
                    <div class="card-option-icon">‚úÖ</div>
                    Gepflegt
                </div>
                <div class="card-option" onclick="setSelect('cond', 'Saniert', this)">
                    <div class="card-option-icon">üõ†Ô∏è</div>
                    Saniert
                </div>
                <div class="card-option" onclick="setSelect('cond', 'Renovierungsbed√ºrftig', this)">
                    <div class="card-option-icon">‚ö†Ô∏è</div>
                    Renovierungsbed√ºrftig
                </div>
            </div>
            <button class="btn-main" onclick="nextStep(4)">Weiter</button>
            <button class="btn-outline-dark" onclick="nextStep(2)">‚Üê Zur√ºck</button>
        </div>
    </div>

    <!-- STEP 4: AUSSTATTUNG -->
    <div class="step" id="step4">
        <div class="step-content">
            <h2>Qualit√§t der Ausstattung</h2>
            <div class="grid-options">
                <div class="card-option" onclick="setSelect('qual', 'Einfach', this)">
                    <div class="card-option-icon">üîπ</div>
                    Einfach
                </div>
                <div class="card-option" onclick="setSelect('qual', 'Standard', this)">
                    <div class="card-option-icon">üî∏</div>
                    Standard
                </div>
                <div class="card-option" onclick="setSelect('qual', 'Gehoben', this)">
                    <div class="card-option-icon">üíé</div>
                    Gehoben
                </div>
                <div class="card-option" onclick="setSelect('qual', 'Luxus', this)">
                    <div class="card-option-icon">üëë</div>
                    Luxus
                </div>
            </div>
            <div class="full-tooltip">
                <strong>Der verborgene Schatz:</strong><br>
                Wussten Sie, dass kleine Optimierungen an der Ausstattung (Home Staging, kleine Reparaturen) den Verkaufspreis oft um <strong>10-15%</strong> heben k√∂nnen? Das sieht kein Algorithmus.
                <div class="tooltip-cta">
                    <strong>Unsicher bei der Einstufung?</strong><br>
                    <a href="#" onclick="openCalendly(); return false;">
                        ‚Üí Experten-Shortcall vereinbaren (5 Min.)
                    </a>
                </div>
            </div>
            <button class="btn-main" style="margin-top:25px;" onclick="nextStep(5)">Weiter</button>
            <button class="btn-outline-dark" onclick="nextStep(3)">‚Üê Zur√ºck</button>
        </div>
    </div>

    <!-- STEP 5: BESONDERHEITEN -->
    <div class="step" id="step5">
        <div class="step-content">
            <h2>Besonderheiten</h2>
            <p style="color: var(--text-secondary); margin-bottom: 25px;">W√§hlen Sie alle zutreffenden Merkmale (Mehrfachauswahl m√∂glich):</p>
            <div id="feat_grid" class="grid-options"></div>
            <button class="btn-main" onclick="nextStep(6)">Weiter</button>
            <button class="btn-outline-dark" onclick="nextStep(4)">‚Üê Zur√ºck</button>
        </div>
    </div>

    <!-- STEP 6: LAGE -->
    <div class="step" id="step6">
        <div class="step-content">
            <h2>Lage der Immobilie</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">Geben Sie die Adresse oder den Ort ein:</p>
            <input type="text" id="addr_input" placeholder="z.B. Hauptstra√üe 12, Neustadt">
            <div id="addr_res"></div>
            <div id="map"></div>
            
            <div class="full-tooltip">
                <strong>Ihre Lage ist besonders?</strong><br>
                Mikrolage, Nachbarschaft und lokale Infrastruktur k√∂nnen den Wert um bis zu <strong>¬±15%</strong> beeinflussen.
                <div class="tooltip-cta">
                    <a href="#" onclick="openCalendly(); return false;">
                        ‚Üí Jetzt pers√∂nliche Lageeinsch√§tzung sichern
                    </a>
                </div>
            </div>

            <button class="btn-main" style="margin-top: 25px;" onclick="confirmAddress()">Jetzt erste Price Range erhalten</button>
            <button class="btn-outline-dark" onclick="nextStep(5)">‚Üê Zur√ºck</button>
        </div>
    </div>

    <!-- STEP 7: ERGEBNIS (SCHNELLBEWERTUNG) -->
    <div class="step" id="step7">
        <div class="step-content">
            <div class="result-card">
                <div class="result-card-label">Vorl√§ufige Bewertung</div>
                <div class="result-card-value" id="res_range">320.000 - 380.000 ‚Ç¨</div>
                <div class="result-card-subtext">Basierend auf Ihren Angaben</div>
            </div>

            <!-- WARNING BOX -->
            <div class="warning-box">
                <h3>ACHTUNG: Diese Sch√§tzung ber√ºcksichtigt NICHT:</h3>
                <ul class="warning-list">
                    <li><strong>Mikrolage & Nachbarschaft</strong> (¬±15% Preiseinfluss)</li>
                    <li><strong>Verkaufspsychologie & Timing</strong> (¬±8% Preiseinfluss)</li>
                    <li><strong>Versteckte Werttreiber</strong> Ihrer Immobilie</li>
                    <li><strong>Steueroptimale Verkaufsstrategie</strong></li>
                </ul>
                <div class="warning-cta-box">
                    <div class="warning-cta-text" onclick="scrollToCalendly()">
                        ‚Üí Im Strategiegespr√§ch identifizieren wir Ihr tats√§chliches Potenzial
                    </div>
                </div>
            </div>

            <!-- INSIGHT CARDS -->
            <div class="insight-grid">
                <div class="insight-card">
                    <div class="insight-title">Haftungsfalle GEG</div>
                    <div class="insight-text">
                        Neue Heizungsgesetze mindern den Wert drastisch ‚Äì es sei denn, man positioniert die Immobilie strategisch richtig. Wir pr√ºfen Ihren Sanierungsstatus.
                    </div>
                </div>
                <div class="insight-card">
                    <div class="insight-title">Zielgruppen-Analyse</div>
                    <div class="insight-text">
                        Wer ist Ihr K√§ufer? Ein Investor zahlt anders als eine junge Familie. Wir wissen, wer in Ihrer Lage aktuell am meisten bietet.
                    </div>
                </div>
                <div class="insight-card">
                    <div class="insight-title">Zeitaufwand</div>
                    <div class="insight-text">
                        Ein privater Verkauf kostet im Schnitt 80-120 Arbeitsstunden. Wir √ºbernehmen die komplette F√ºhrung ‚Äì diskret und rechtssicher.
                    </div>
                </div>
            </div>

            <button class="btn-main" onclick="nextStep(8)" style="font-size: 17px; padding: 20px;">
                Detaillierte Analyse anzeigen
            </button>
            
            <div class="cta-box">
                <div class="cta-box-text">
                    <strong>Kostenloses Strategiegespr√§ch ‚Äì 100% unverbindlich</strong>
                    Danach entscheiden Sie in Ruhe, ob wir zusammenarbeiten.
                </div>
                <button class="btn-outline-dark" onclick="scrollToCalendly()">
                    Termin vereinbaren
                </button>
            </div>

            <div id="calendly-box" style="margin-top:50px; border-top:2px solid var(--border); padding-top:40px;">
                <div class="calendly-inline-widget" data-url="https://calendly.com/d-will-sw-immobilien/strategische-ersteinschatzung-verkauf" style="min-width:320px;height:700px;"></div>
            </div>
        </div>
    </div>

    <!-- STEP 8: DETAILLIERTE ANALYSE -->
    <div class="step" id="step8">
        <div class="analysis-header">
            <h1>Detaillierte Immobilienanalyse</h1>
            <p>Professionelle Bewertung nach Sachwert- und Marktwertverfahren</p>
        </div>

        <div class="step-content">
            <!-- VERKAUFSZEITRAUM -->
            <div style="margin-bottom: 40px;">
                <h3>Wann planen Sie den Verkauf?</h3>
                <div class="grid-options">
                    <div class="card-option" onclick="setSelect('timing', 'Innerhalb 3 Monate', this); updateBuyerCount();">
                        <div class="card-option-icon">üî•</div>
                        Innerhalb 3 Monate
                    </div>
                    <div class="card-option" onclick="setSelect('timing', '3-6 Monate', this); updateBuyerCount();">
                        <div class="card-option-icon">üìÖ</div>
                        3-6 Monate
                    </div>
                    <div class="card-option" onclick="setSelect('timing', '6-12 Monate', this); updateBuyerCount();">
                        <div class="card-option-icon">üóìÔ∏è</div>
                        6-12 Monate
                    </div>
                    <div class="card-option" onclick="setSelect('timing', 'Erst informieren', this); updateBuyerCount();">
                        <div class="card-option-icon">üí°</div>
                        Erst informieren
                    </div>
                </div>
            </div>

            <!-- ANALYSE GRID -->
            <div class="analysis-grid">
                <div class="analysis-card">
                    <div class="analysis-label">Sachwertverfahren</div>
                    <div class="analysis-value" id="res_sach">285.000 ‚Ç¨</div>
                    <div class="analysis-sub">Bausubstanz + Grundst√ºck</div>
                </div>
                <div class="analysis-card">
                    <div class="analysis-label">Marktwertverfahren</div>
                    <div class="analysis-value" id="res_market">350.000 ‚Ç¨</div>
                    <div class="analysis-sub">Vergleichsobjekte + Lage</div>
                </div>
                <div class="analysis-card">
                    <div class="analysis-label">Aktive K√§ufersuchen</div>
                    <div class="analysis-value" id="res_cust">127</div>
                    <div class="analysis-sub">In Ihrer Region</div>
                </div>
            </div>

            <!-- CALCULATION BREAKDOWNS -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin: 35px 0;">
                <div class="calculation-breakdown">
                    <div class="breakdown-title">Sachwertverfahren</div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Bodenwert (<span id="plot_area">500</span>m¬≤ √ó <span id="land_price">400</span> ‚Ç¨/m¬≤)</span>
                        <span class="breakdown-value" id="land_value">200.000 ‚Ç¨</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Geb√§udewert (Baujahr <span id="build_year">1995</span>, <span id="living_area">120</span>m¬≤)</span>
                        <span class="breakdown-value" id="building_value">385.000 ‚Ç¨</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Au√üenanlagen & Zubeh√∂r</span>
                        <span class="breakdown-value" id="extras_value">45.000 ‚Ç¨</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Sachwert gesamt</span>
                        <span class="breakdown-value" id="total_sach">630.000 ‚Ç¨</span>
                    </div>
                </div>

                <div class="calculation-breakdown">
                    <div class="breakdown-title">Marktwertverfahren</div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">√ò Verkaufspreis Region</span>
                        <span class="breakdown-value" id="avg_price">3.850 ‚Ç¨/m¬≤</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Lagefaktor</span>
                        <span class="breakdown-value" id="location_factor">+12%</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Ausstattungsbonus</span>
                        <span class="breakdown-value" id="equipment_bonus">+8%</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Marktwert gesch√§tzt</span>
                        <span class="breakdown-value" id="total_market">520.000 ‚Ç¨</span>
                    </div>
                </div>
            </div>

            <!-- BUYER DATABASE WITH 5-MIN TIMER -->
            <div class="database-search">
                <h2>Interessentendatenbank durchsuchen</h2>
                <p style="opacity: 0.95; margin-bottom: 25px; font-size: 15px;">
                    Exklusiver Einblick: Pr√ºfen Sie, welche K√§ufer aktuell genau nach Ihrer Immobilie suchen
                </p>

                <!-- TIMER (shown after button click) -->
                <div class="database-timer" id="databaseTimer">
                    <div style="font-size: 14px; font-weight: 600; margin-bottom: 10px;">Zugang l√§uft ab in:</div>
                    <div class="timer-display" id="timerDisplay">5:00</div>
                    <div class="timer-warning">Nach Ablauf ist eine Freischaltung nur im pers√∂nlichen Gespr√§ch m√∂glich</div>
                </div>

                <button class="btn-main" onclick="startDatabaseSearch()" id="searchBtn" style="background: white; color: #ec4899; max-width: 450px; margin: 0 auto; display: block; font-size: 16px;">
                    Marktpotenzial jetzt pr√ºfen (5 Min. Zugang)
                </button>

                <!-- SEARCH ANIMATION -->
                <div class="search-animation" id="searchAnimation">
                    <div class="search-spinner"></div>
                    <p style="font-size: 14px; opacity: 0.9;">Durchsuche 1.247 Interessenten in der Region...</p>
                </div>

                <!-- BUYER RESULTS -->
                <div class="buyer-results" id="buyerResults">
                    <div class="buyer-results-header"><span id="matchCount">47</span> passende K√§ufersuchen gefunden</div>
                    <div class="buyer-results-subtext">Sortiert nach √úbereinstimmung mit Ihrer Immobilie</div>
                    
                    <div class="buyer-progress">
                        <span class="progress-text">Anzeige:</span>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" id="progressBar" style="width: 8.5%;"></div>
                        </div>
                        <span class="progress-text"><span id="shownMatches">4</span> von <span id="totalMatches">47</span></span>
                    </div>

                    <div id="buyerMatchesContainer"></div>

                    <div class="pagination-dots" id="paginationDots">
                        <div class="pagination-dot active" onclick="showBuyerPage(0)"></div>
                        <div class="pagination-dot" onclick="showBuyerPage(1)"></div>
                        <div class="pagination-dot" onclick="showBuyerPage(2)"></div>
                        <div class="pagination-dot" onclick="showBuyerPage(3)"></div>
                    </div>

                    <div class="premium-unlock" id="premiumUnlock" style="display: none;">
                        <div class="unlock-icon">üîí</div>
                        <h3 style="color: white; margin-bottom: 12px;">Premium-Zugang erforderlich</h3>
                        <p style="font-size: 15px; opacity: 0.9; margin-bottom: 25px;">
                            Sie haben 4 von <span id="totalMatchesFinal">47</span> Interessenten gesehen. 
                            <strong>Alle <span id="remainingMatches">43</span> weiteren Profile</strong> werden im Strategiegespr√§ch freigeschaltet.
                        </p>
                        <button class="btn-main" onclick="scrollToCalendly()" style="background: white; color: #ec4899; max-width: 100%;">
                            Alle Interessenten freischalten
                        </button>
                    </div>

                    <div style="background: rgba(255,255,255,0.2); padding: 30px; border-radius: 6px; margin-top: 30px; backdrop-filter: blur(10px);">
                        <strong style="font-size: 19px; display: block; margin-bottom: 15px;">
                            Diese K√§ufer warten auf Ihre Immobilie
                        </strong>
                        <p style="font-size: 14px; margin-bottom: 25px; opacity: 0.95;">
                            Im Strategiegespr√§ch kl√§ren wir, welcher K√§ufertyp den <strong>h√∂chsten Preis</strong> zahlt und wie wir Ihre Immobilie optimal positionieren.
                        </p>
                        <button class="btn-main" onclick="scrollToCalendly()" style="background: var(--cta); max-width: 100%;">
                            Jetzt Strategiegespr√§ch vereinbaren
                        </button>
                    </div>
                </div>
            </div>

            <!-- FINAL CTA -->
            <div style="text-align: center; margin-top: 40px;">
                <button class="btn-outline-dark" onclick="nextStep(7)">‚Üê Zur√ºck zur √úbersicht</button>
            </div>

            <div id="calendly-box-detailed" style="margin-top:50px; border-top:2px solid var(--border); padding-top:40px;">
                <div class="calendly-inline-widget" data-url="https://calendly.com/d-will-sw-immobilien/strategische-ersteinschatzung-verkauf" style="min-width:320px;height:700px;"></div>
            </div>
        </div>
    </div>

</div>

<script>
    emailjs.init("_xVMakll6CBznjSHE");

    let state = {
        category: '', sub: '', living: 120, plot: 500, year: 1995,
        cond: '', qual: '', timing: '', feats: {}, address: '',
        buyerSearchHash: '' // for consistent results
    };

    let mapInitialized = false;
    let map, marker;
    let timerInterval = null;
    let timeRemaining = 300; // 5 minutes in seconds
    let currentPage = 0;
    let buyerMatches = [];

    // ========== NAVIGATION ==========
    function nextStep(s) {
        document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
        document.getElementById('step' + s).classList.add('active');
        
        if(s >= 3) {
            document.getElementById('stickyCta').classList.add('visible');
        }
        
        if(s === 6 && !mapInitialized) {
            initMap();
        }
        
        if(s === 7) runCalculation();
        if(s === 8) {
            runDetailedCalculation();
            generateBuyerSearchHash();
        }
        
        window.scrollTo(0,0);
    }

    // ========== STICKY CTA ==========
    window.addEventListener('scroll', function() {
        const scrolled = window.pageYOffset;
        const stickyBtn = document.getElementById('stickyCta');
        if(scrolled > 400) {
            stickyBtn.classList.add('visible');
        }
    });

    // ========== EXIT INTENT POPUP ==========
    let exitModalShown = false;
    document.addEventListener('mouseleave', function(e) {
        if(e.clientY <= 0 && !exitModalShown) {
            document.getElementById('exitModal').classList.add('show');
            exitModalShown = true;
        }
    });

    function closeExitModal() {
        document.getElementById('exitModal').classList.remove('show');
    }

    // ========== STEP 1 LOGIC ==========
    const subMap = {
        haus: ["Einfamilienhaus", "Doppelhaus", "Reihenhaus", "Bungalow", "Stadtvilla", "Sonstiges"],
        wohnung: ["Etagenwohnung", "Erdgeschosswohnung", "Dachgeschosswohnung", "Penthouse", "Sonstiges"],
        gewerbe: ["Ladenlokal", "Halle", "B√ºrofl√§chen", "Sonstiges"],
        grundstueck: ["Erschlossen", "Mit Abrissimmobilie", "Frei / Unerschlossen"]
    };

    function selectCat(c) {
        state.category = c;
        const grid = document.getElementById('subCatGrid');
        grid.innerHTML = '';
        subMap[c].forEach(s => {
            let d = document.createElement('div');
            d.className = 'card-option';
            d.innerHTML = `<strong>${s}</strong>`;
            d.onclick = () => { state.sub = s; nextStep(2); };
            grid.appendChild(d);
        });
        document.getElementById('subCatWrapper').classList.remove('hidden');
        document.getElementById('plot_box').style.display = (c === 'gewerbe') ? 'none' : 'block';
    }

    // ========== SYNC SLIDER & INPUT ==========
    function sync(type, source) {
        let val = (source === 'rng') ? document.getElementById('rng_'+type).value : document.getElementById('num_'+type).value;
        document.getElementById('rng_'+type).value = val;
        document.getElementById('num_'+type).value = val;
        state[type] = parseInt(val);
    }
    ['living','plot','year'].forEach(t => sync(t, 'rng'));

    function checkFlowStep2() {
        if(state.category === 'grundstueck' || state.category === 'gewerbe') nextStep(6);
        else nextStep(3);
    }

    // ========== ZUSTAND & QUALIT√ÑT ==========
    function setSelect(field, val, el) {
        state[field] = val;
        el.parentNode.querySelectorAll('.card-option').forEach(x => x.classList.remove('selected'));
        el.classList.add('selected');
    }

    // ========== BESONDERHEITEN ==========
    const feats = [
        "Garage", "Stellplatz", "Carport", "Pool", "Einliegerwohnung", 
        "Sauna", "Keller", "Balkon", "Terrasse", "Garten", 
        "Kamin", "Fu√übodenheizung", "Photovoltaik", "Alarmanlage"
    ];
    const featIcons = {
        "Garage": "üöó", "Stellplatz": "üÖøÔ∏è", "Carport": "üè†",
        "Pool": "üèä", "Einliegerwohnung": "üèòÔ∏è", "Sauna": "üßñ",
        "Keller": "üì¶", "Balkon": "üåø", "Terrasse": "‚òÄÔ∏è",
        "Garten": "üå≥", "Kamin": "üî•", "Fu√übodenheizung": "‚ô®Ô∏è",
        "Photovoltaik": "‚ö°", "Alarmanlage": "üîí"
    };

    function renderFeats() {
        const grid = document.getElementById('feat_grid');
        grid.innerHTML = '';
        feats.forEach(f => {
            let d = document.createElement('div');
            d.className = 'card-option' + (state.feats[f] ? ' selected' : '');
            d.innerHTML = `
                <div class="card-option-icon">${featIcons[f]}</div>
                ${f}
            `;
            
            if(state.feats[f]) {
                let badge = document.createElement('div');
                badge.className = 'badge';
                badge.innerText = state.feats[f];
                badge.onclick = (e) => { e.stopPropagation(); };
                d.appendChild(badge);
                
                let minus = document.createElement('div');
                minus.className = 'badge-minus';
                minus.innerHTML = '‚àí';
                minus.onclick = (e) => { e.stopPropagation(); removeFeat(f); };
                d.appendChild(minus);
            }
            
            d.onclick = () => addFeat(f);
            grid.appendChild(d);
        });
    }
    
    function addFeat(f) { 
        state.feats[f] = (state.feats[f] || 0) + 1; 
        renderFeats(); 
    }
    
    function removeFeat(f) { 
        if(state.feats[f] > 0) state.feats[f]--;
        if(state.feats[f] === 0) delete state.feats[f];
        renderFeats();
    }
    renderFeats();

    // ========== MAP & ADDRESS ==========
    function initMap() {
        map = L.map('map').setView([49.4701, 8.1342], 10);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        marker = L.marker([49.4701, 8.1342]).addTo(map);
        mapInitialized = true;
    }

    document.getElementById('addr_input').addEventListener('input', function(e) {
        let q = e.target.value;
        if(q.length < 5) return;
        fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${q}&countrycodes=de`)
        .then(r => r.json()).then(res => {
            const container = document.getElementById('addr_res');
            container.innerHTML = '';
            res.forEach(p => {
                let d = document.createElement('div');
                d.className = 'addr-result-item';
                d.innerText = p.display_name;
                d.onclick = () => {
                    state.address = p.display_name;
                    document.getElementById('addr_input').value = p.display_name;
                    marker.setLatLng([p.lat, p.lon]);
                    map.setView([p.lat, p.lon], 16);
                    container.innerHTML = '';
                };
                container.appendChild(d);
            });
        });
    });

    function confirmAddress() {
        if(!state.address) return alert("Bitte w√§hlen Sie eine Adresse aus der Liste");
        emailjs.send("service_9wal0zr", "template_bwjdkei", { 
            address: state.address,
            category: state.category,
            sub: state.sub,
            living: state.living,
            plot: state.plot,
            year: state.year,
            condition: state.cond,
            quality: state.qual
        });
        nextStep(7);
    }

    // ========== BASIC CALCULATION ==========
    function runCalculation() {
        let base = (state.living * 3200) + (state.plot * 160);
        
        if(state.qual === 'Luxus') base *= 1.25;
        else if(state.qual === 'Gehoben') base *= 1.12;
        
        if(state.cond === 'Neubau') base *= 1.15;
        else if(state.cond === 'Renovierungsbed√ºrftig') base *= 0.75;
        
        let featBonus = Object.values(state.feats).reduce((a,b) => a+b, 0) * 5000;
        base += featBonus;
        
        let lower = Math.round(base * 0.94 / 1000) * 1000;
        let upper = Math.round(base * 1.06 / 1000) * 1000;
        
        document.getElementById('res_range').innerText = lower.toLocaleString('de-DE') + " ‚Ç¨ - " + upper.toLocaleString('de-DE') + " ‚Ç¨";
    }

    // ========== DETAILED CALCULATION ==========
    function runDetailedCalculation() {
        // Sachwert
        const landPrice = Math.floor(Math.random() * 200) + 350; // 350-550 ‚Ç¨/m¬≤
        const landValue = state.plot * landPrice;
        const buildingValue = state.living * 2800 * (1 - (2025 - state.year) * 0.008);
        const extrasValue = Object.values(state.feats).reduce((a,b) => a+b, 0) * 8000;
        const totalSach = Math.round((landValue + buildingValue + extrasValue) * 0.85);
        
        // Marktwert
        const avgPrice = Math.floor(Math.random() * 800) + 3400; // 3400-4200 ‚Ç¨/m¬≤
        const locationFactor = Math.floor(Math.random() * 8) + 8; // 8-15%
        const equipmentBonus = state.qual === 'Luxus' ? 15 : state.qual === 'Gehoben' ? 10 : 5;
        const totalMarket = Math.round(state.living * avgPrice * (1 + locationFactor/100) * (1 + equipmentBonus/100));
        
        // Update UI
        document.getElementById('plot_area').innerText = state.plot;
        document.getElementById('land_price').innerText = landPrice;
        document.getElementById('land_value').innerText = landValue.toLocaleString('de-DE') + ' ‚Ç¨';
        document.getElementById('build_year').innerText = state.year;
        document.getElementById('living_area').innerText = state.living;
        document.getElementById('building_value').innerText = Math.round(buildingValue).toLocaleString('de-DE') + ' ‚Ç¨';
        document.getElementById('extras_value').innerText = extrasValue.toLocaleString('de-DE') + ' ‚Ç¨';
        document.getElementById('total_sach').innerText = totalSach.toLocaleString('de-DE') + ' ‚Ç¨';
        
        document.getElementById('avg_price').innerText = avgPrice.toLocaleString('de-DE') + ' ‚Ç¨/m¬≤';
        document.getElementById('location_factor').innerText = '+' + locationFactor + '%';
        document.getElementById('equipment_bonus').innerText = '+' + equipmentBonus + '%';
        document.getElementById('total_market').innerText = totalMarket.toLocaleString('de-DE') + ' ‚Ç¨';
        
        document.getElementById('res_sach').innerText = totalSach.toLocaleString('de-DE') + ' ‚Ç¨';
        document.getElementById('res_market').innerText = totalMarket.toLocaleString('de-DE') + ' ‚Ç¨';
    }

    // ========== BUYER COUNT BASED ON INPUT ==========
    function generateBuyerSearchHash() {
        const hashInput = state.address + state.category + state.living + state.plot;
        let hash = 0;
        for(let i = 0; i < hashInput.length; i++) {
            hash = ((hash << 5) - hash) + hashInput.charCodeAt(i);
            hash = hash & hash;
        }
        state.buyerSearchHash = Math.abs(hash);
    }

    function updateBuyerCount() {
        if(!state.buyerSearchHash) generateBuyerSearchHash();
        
        // Generate consistent count based on hash
        const baseCount = 27 + (state.buyerSearchHash % 26); // 27-52
        const timingMultiplier = state.timing === 'Innerhalb 3 Monate' ? 1.2 : 
                                 state.timing === '3-6 Monate' ? 1.1 : 1.0;
        const finalCount = Math.floor(baseCount * timingMultiplier);
        
        document.getElementById('res_cust').innerText = finalCount;
    }

    // ========== 5-MINUTE TIMER DATABASE SEARCH ==========
    function startDatabaseSearch() {
        const btn = document.getElementById('searchBtn');
        const timer = document.getElementById('databaseTimer');
        const animation = document.getElementById('searchAnimation');
        const results = document.getElementById('buyerResults');
        
        btn.style.display = 'none';
        animation.classList.add('active');
        
        // Generate buyer matches
        generateBuyerMatches();
        
        // Simulate search
        setTimeout(() => {
            animation.classList.remove('active');
            timer.classList.add('active');
            results.classList.add('show');
            
            // Start 5-minute countdown
            startTimer();
            
            // Show first page
            showBuyerPage(0);
        }, 2500);
    }

    function startTimer() {
        updateTimerDisplay();
        timerInterval = setInterval(() => {
            timeRemaining--;
            updateTimerDisplay();
            
            if(timeRemaining <= 0) {
                clearInterval(timerInterval);
                document.getElementById('databaseTimer').innerHTML = '<div style="color: #fecaca; font-weight: 700;">Zugang abgelaufen</div>';
            }
        }, 1000);
    }

    function updateTimerDisplay() {
        const minutes = Math.floor(timeRemaining / 60);
        const seconds = timeRemaining % 60;
        document.getElementById('timerDisplay').innerText = 
            minutes + ':' + (seconds < 10 ? '0' : '') + seconds;
    }

    function generateBuyerMatches() {
        if(!state.buyerSearchHash) generateBuyerSearchHash();
        
        const totalMatches = 27 + (state.buyerSearchHash % 26);
        document.getElementById('matchCount').innerText = totalMatches;
        document.getElementById('totalMatches').innerText = totalMatches;
        document.getElementById('totalMatchesFinal').innerText = totalMatches;
        document.getElementById('remainingMatches').innerText = totalMatches - 4;
        
        buyerMatches = [];
        
        const profiles = [
            {
                type: "Familie",
                budget: "bis 450.000 ‚Ç¨",
                search: `${state.sub || 'Haus'}, ${state.living - 20}-${state.living + 30}m¬≤, Raum ${state.address.split(',')[1] || 'Pfalz'}`,
                status: "Finanzierung best√§tigt",
                special: "‚úÖ"
            },
            {
                type: "Investor",
                budget: "flexibel",
                search: `Kapitalanlage, ${state.category === 'haus' ? 'Haus' : 'Wohnung'}, ${state.address.split(',')[1] || 'Region'}`,
                status: "Barzahlung m√∂glich",
                special: "üí∞"
            },
            {
                type: "K√§ufer",
                budget: `${Math.round(state.living * 3000 / 1000) * 1000} - ${Math.round(state.living * 4000 / 1000) * 1000} ‚Ç¨`,
                search: `${state.sub || state.category}, ruhige Lage, ${state.plot > 300 ? 'Garten erw√ºnscht' : 'zentral'}`,
                status: "Aktiv suchend",
                special: "‚ö°"
            },
            {
                type: "Vorgemerkt",
                budget: "bis " + Math.round(state.living * 3800 / 1000) * 1000 + " ‚Ç¨",
                search: `${state.category}, ${state.living - 30}-${state.living + 20}m¬≤, ${state.address.split(',')[1] || 'Umkreis'}`,
                status: "Bereits bekannter Kunde",
                special: "üèÜ"
            }
        ];
        
        for(let i = 0; i < 4; i++) {
            const profile = profiles[i];
            const daysAgo = 3 + Math.floor((state.buyerSearchHash + i * 7) % 18);
            const matchScore = 75 + Math.floor((state.buyerSearchHash + i * 13) % 20);
            
            buyerMatches.push({
                id: 'KI-2026-' + (4200 + state.buyerSearchHash % 1000 + i * 73) + '-PF',
                date: `Vor ${daysAgo} Tagen`,
                score: matchScore + '%',
                profile: profile
            });
        }
    }

    function showBuyerPage(page) {
        currentPage = page;
        
        // Update pagination
        document.querySelectorAll('.pagination-dot').forEach((dot, i) => {
            dot.classList.toggle('active', i === page);
        });
        
        if(page >= 3) {
            // Show premium unlock
            document.getElementById('buyerMatchesContainer').style.display = 'none';
            document.getElementById('paginationDots').style.display = 'none';
            document.getElementById('premiumUnlock').style.display = 'block';
            return;
        }
        
        // Show buyer match
        const match = buyerMatches[page];
        const container = document.getElementById('buyerMatchesContainer');
        container.innerHTML = `
            <div class="buyer-match">
                <div class="buyer-match-header">
                    <span class="buyer-id">${match.id}</span>
                    <div>
                        <span class="buyer-match-score">${match.score} Match</span>
                        <span class="buyer-date">${match.date}</span>
                    </div>
                </div>
                <div class="buyer-criteria">
                    <div class="buyer-criteria-item">
                        <span class="buyer-criteria-label">Typ:</span>
                        <span class="buyer-criteria-value">${match.profile.type}</span>
                    </div>
                    <div class="buyer-criteria-item">
                        <span class="buyer-criteria-label">Budget:</span>
                        <span class="buyer-criteria-value">${match.profile.budget}</span>
                    </div>
                    <div class="buyer-criteria-item">
                        <span class="buyer-criteria-label">Suchprofil:</span>
                        <span class="buyer-criteria-value">${match.profile.search}</span>
                    </div>
                    <div class="buyer-criteria-item">
                        <span class="buyer-criteria-label">Status:</span>
                        <span class="buyer-criteria-value">${match.profile.status} ${match.profile.special}</span>
                    </div>
                </div>
            </div>
        `;
        
        // Update progress bar
        const progress = ((page + 1) / buyerMatches.length) * 100;
        document.getElementById('progressBar').style.width = progress + '%';
        document.getElementById('shownMatches').innerText = page + 1;
    }

    // ========== HELPERS ==========
    function scrollToCalendly() { 
        const box = document.getElementById('calendly-box') || document.getElementById('calendly-box-detailed');
        if(box) box.scrollIntoView({behavior:'smooth'}); 
    }
    
    function openCalendly() { 
        window.open("https://calendly.com/d-will-sw-immobilien/strategische-ersteinschatzung-verkauf", "_blank"); 
    }
</script>
<script src="https://assets.calendly.com/assets/external/widget.js" async></script>
</body>
</html>
