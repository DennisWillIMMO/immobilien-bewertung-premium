<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategische Immobilienbewertung | SW Immobilien</title>
    
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <style>
        :root {
            --primary: #0e3a67;
            --accent: #c7a44c;
            --cta: #d9534f;
            --bg: #f8f9fa;
            --card: #ffffff;
            --border: #e2e8f0;
        }

        body {
            margin: 0;
            background: var(--bg);
            font-family: 'DM Sans', sans-serif;
            color: #1a1a1a;
        }

        .app-wrapper { max-width: 900px; margin: 0 auto; padding: 20px; }

        /* Progress Bar */
        .progress-container { height: 6px; background: #e2e8f0; border-radius: 10px; margin-bottom: 40px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.4s ease; }

        .step { display: none; background: var(--card); padding: 40px; border-radius: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.05); }
        .step.active { display: block; animation: fadeIn 0.5s ease; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h2 { font-size: 38px; color: var(--primary); line-height: 1.2; margin-bottom: 15px; }
        h3 { font-size: 26px; color: var(--primary); margin-bottom: 25px; }

        /* Buttons & Cards */
        .grid { display: grid; gap: 20px; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
        
        .card-option {
            border: 1px solid var(--border);
            padding: 30px 20px;
            border-radius: 16px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            position: relative;
        }
        .card-option:hover { border-color: var(--primary); transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .card-option.selected { border: 2px solid var(--primary); background: #f0f5fb; }
        
        .icon-box { font-size: 40px; margin-bottom: 10px; display: block; }
        .badge {
            position: absolute; top: 10px; right: 10px;
            background: var(--primary); color: white;
            width: 24px; height: 24px; border-radius: 50%;
            font-size: 12px; display: flex; align-items: center; justify-content: center;
        }

        .btn-main {
            background: var(--primary); color: white; border: none;
            padding: 18px 35px; border-radius: 12px; font-weight: 700;
            cursor: pointer; font-size: 16px; width: 100%;
        }
        .btn-cta { background: var(--cta); margin-bottom: 15px; }
        .btn-sub { background: none; color: var(--primary); border: 1px solid var(--primary); margin-top: 15px; }
        .btn-secondary { background: #e2e8f0; color: #444; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; }

        /* Inputs */
        .input-group { margin-bottom: 25px; }
        label { display: block; font-weight: 600; margin-bottom: 8px; }
        input[type="range"] { width: 100%; margin-bottom: 10px; accent-color: var(--primary); }
        input[type="number"], input[type="text"], input[type="email"], select {
            width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; box-sizing: border-box;
        }

        #map { height: 300px; border-radius: 12px; margin-top: 20px; }
        .hidden { display: none; }

        .result-box { border: 2px solid var(--primary); padding: 30px; border-radius: 20px; text-align: center; margin: 30px 0; }
        .price-tag { font-size: 36px; font-weight: 800; color: var(--primary); }

        .footer-links { text-align: center; margin-top: 50px; font-size: 13px; color: #888; }
        .footer-links a { color: var(--primary); text-decoration: none; margin: 0 10px; }
    </style>
</head>
<body>

<div class="app-wrapper">
    <div class="progress-container"><div class="progress-fill" id="progressFill"></div></div>

    <div class="step active" id="stepIntro">
        <img src="http://sw-immobilien.de/wp-content/uploads/2026/01/dennis-will-immobilien.jpg" style="width: 100px; border-radius: 50%; margin-bottom: 20px;">
        <h2>Ihre Immobilie ist kein Algorithmus.</h2>
        <p>Ein Verm√∂genswert verdient Manufaktur-Qualit√§t statt Massenabfertigung. Starten Sie hier Ihre erste Marktindikation oder buchen Sie direkt das Strategiegespr√§ch.</p>
        
        <button class="btn-main btn-cta" onclick="openCalendly()">Strategiegespr√§ch vereinbaren</button>
        <button class="btn-main btn-sub" onclick="nextStep(1)">Diskrete Online-Analyse starten ‚Üí</button>
        
        <div style="margin-top: 30px; display: flex; justify-content: center; gap: 20px;">
            <img src="http://sw-immobilien.de/wp-content/uploads/2025/10/1.jpg" height="60">
            <img src="http://sw-immobilien.de/wp-content/uploads/2024/04/ImmoScout24-Siegel_Experte-200x200-1.png" height="60">
        </div>
    </div>

    <div class="step" id="step1">
        <h3>Welche Art Immobilie bewerten wir?</h3>
        <div class="grid">
            <div class="card-option" onclick="selectCat('haus', 'üè†')"><span class="icon-box">üè†</span>Haus</div>
            <div class="card-option" onclick="selectCat('wohnung', 'üè¢')"><span class="icon-box">üè¢</span>Wohnung</div>
            <div class="card-option" onclick="selectCat('gewerbe', 'üè≠')"><span class="icon-box">üè≠</span>Gewerbe</div>
            <div class="card-option" onclick="selectCat('grundstueck', 'üå±')"><span class="icon-box">üå±</span>Grundst√ºck</div>
        </div>

        <div id="subCatWrapper" class="hidden" style="margin-top: 30px;">
            <h4>Spezifizieren Sie den Typ:</h4>
            <div id="subCatGrid" class="grid"></div>
        </div>
        
        <div style="margin-top:40px;">
            <button class="btn-secondary" onclick="prevStep()">Zur√ºck</button>
        </div>
    </div>

    <div class="step" id="step2">
        <h3>Eckdaten der Immobilie</h3>
        
        <div class="input-group">
            <label>Wohnfl√§che: <span id="val_living">120</span> m¬≤</label>
            <input type="range" id="range_living" min="20" max="500" value="120" oninput="sync('living')">
            <input type="number" id="num_living" value="120" oninput="sync('living')">
        </div>

        <div class="input-group" id="plot_group">
            <label>Grundst√ºcksfl√§che: <span id="val_plot">500</span> m¬≤</label>
            <input type="range" id="range_plot" min="0" max="2000" value="500" oninput="sync('plot')">
            <input type="number" id="num_plot" value="500" oninput="sync('plot')">
        </div>

        <div class="input-group">
            <label>Baujahr: <span id="val_year">1995</span></label>
            <input type="range" id="range_year" min="1900" max="2025" value="1995" oninput="sync('year')">
            <input type="number" id="num_year" value="1995" oninput="sync('year')">
        </div>

        <button class="btn-main" onclick="nextStep(3)">Weiter</button>
        <button class="btn-sub" onclick="prevStep()">Zur√ºck</button>
    </div>

    <div class="step" id="step3">
        <h3>Zustand & Sanierung</h3>
        <div class="grid">
            <div class="card-option" onclick="setCondition('Neubau', this)">Neubau</div>
            <div class="card-option" onclick="setCondition('Modernisiert', this)">Modernisiert</div>
            <div class="card-option" onclick="setCondition('Gepflegt', this)">Gepflegt</div>
            <div class="card-option" onclick="setCondition('Saniert', this)">Saniert</div>
            <div class="card-option" onclick="setCondition('Renovierungsbed√ºrftig', this)">Renovierungsbed√ºrftig</div>
        </div>

        <div id="sanierungYear" class="hidden" style="margin-top:20px;">
            <label>Jahr der Kernsanierung:</label>
            <input type="number" id="san_year" placeholder="z.B. 2018">
        </div>

        <div style="margin-top:30px;">
            <button class="btn-main" onclick="nextStep(4)">Weiter</button>
            <button class="btn-sub" onclick="prevStep()">Zur√ºck</button>
        </div>
    </div>

    <div class="step" id="step4">
        <h3>Ausstattungsqualit√§t</h3>
        <div class="grid">
            <div class="card-option" onclick="setQuality('Einfach', this)">Einfach<br><small>Zweckm√§√üig & schlicht</small></div>
            <div class="card-option" onclick="setQuality('Standard', this)">Standard<br><small>Normaler Wohnkomfort</small></div>
            <div class="card-option" onclick="setQuality('Gehoben', this)">Gehoben<br><small>Hochwertige Materialien</small></div>
            <div class="card-option" onclick="setQuality('Luxus', this)">Luxus<br><small>Exklusiv & Designer-Niveau</small></div>
        </div>
        <div style="margin-top:30px;">
            <button class="btn-main" onclick="nextStep(5)">Weiter</button>
            <button class="btn-sub" onclick="prevStep()">Zur√ºck</button>
        </div>
    </div>

    <div class="step" id="step5">
        <h3>Besonderheiten (Multi-Click)</h3>
        <div class="grid" id="featureGrid">
            </div>
        <div style="margin-top:30px;">
            <button class="btn-main" onclick="nextStep(6)">Weiter zur Lageanalyse</button>
            <button class="btn-sub" onclick="prevStep()">Zur√ºck</button>
        </div>
    </div>

    <div class="step" id="step6">
        <h3>Lage & Marktdaten</h3>
        <p>Ohne die genaue Lage k√∂nnen wir keine Bodenrichtwerte oder Verkaufshistorien ber√ºcksichtigen. Wir behandeln Ihre Daten diskret.</p>
        
        <input type="text" id="address-input" placeholder="PLZ, Ort, Stra√üe eingeben..." autocomplete="off">
        <div id="autocomplete-results" style="background: white; border: 1px solid #ccc; max-height: 200px; overflow-y: auto;"></div>
        
        <div id="map"></div>

        <div style="margin-top:30px;">
            <button class="btn-main" id="confirmAddressBtn" onclick="confirmAddress()">Adresse best√§tigen & Wert berechnen</button>
            <button class="btn-sub" onclick="prevStep()">Zur√ºck</button>
        </div>
    </div>

    <div class="step" id="step7">
        <h3>Ihre Marktindikation</h3>
        
        <div class="result-box">
            <div style="color: #666; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">Voraussichtlicher Marktwert</div>
            <div class="price-tag" id="res_range">---.--- ‚Ç¨</div>
            <p style="margin-top:10px; font-size: 14px;">Basierend auf regionalen Vergleichswerten im Einzugsgebiet.</p>
        </div>

        <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px;">
            <div style="padding: 15px; background: #f1f5f9; border-radius: 12px;">
                <strong>Sachwert</strong><br>
                <span id="res_sachwert" style="font-weight: bold;">--- ‚Ç¨</span><br>
                <small>Substanzwert des Geb√§udes</small>
            </div>
            <div style="padding: 15px; background: #f1f5f9; border-radius: 12px;">
                <strong>Vergleichswert</strong><br>
                <span id="res_vergleich" style="font-weight: bold;">--- ‚Ç¨</span><br>
                <small>Aktuelle Marktpreise</small>
            </div>
        </div>

        <div style="background: #fff8f0; padding: 20px; border-radius: 12px; border-left: 4px solid var(--accent);">
            <strong>Hinweis:</strong> Dieser Wert ist eine algorithmische Ann√§herung. Rechtliche Sicherheit, Sanierungspflichten oder das volle Potenzial Ihrer Immobilie erfahren Sie nur in der Expertenpr√ºfung.
        </div>

        <h3 style="margin-top:40px;">Detailanalyse & Unterlagen-Check erhalten</h3>
        <div class="grid" style="text-align: left;">
            <div>
                <label>Anrede</label>
                <select id="f_salutation"><option>Herr</option><option>Frau</option></select>
            </div>
            <div>
                <label>Name</label>
                <input type="text" id="f_name" placeholder="Ihr Name">
            </div>
            <div>
                <label>E-Mail</label>
                <input type="email" id="f_email" placeholder="mail@beispiel.de">
            </div>
            <div>
                <label>Telefon (f√ºr R√ºckruf-Wunsch)</label>
                <input type="text" id="f_phone" placeholder="Optional">
            </div>
        </div>

        <button class="btn-main btn-cta" style="margin-top:30px;" onclick="sendFinal()">Vollst√§ndige Analyse anfordern</button>
        
        <hr style="margin:40px 0; border: none; border-top: 1px solid #eee;">
        
        <h3>Ihr Verm√∂genswert verdient eine Strategie.</h3>
        <p>Buchen Sie hier direkt Ihren 15-Minuten-Slot f√ºr die professionelle Einsch√§tzung:</p>
        <div id="calendly-area" style="min-height: 600px;">
            <div class="calendly-inline-widget" data-url="https://calendly.com/d-will-sw-immobilien/strategische-ersteinschatzung-verkauf" style="min-width:320px;height:600px;"></div>
        </div>
    </div>

    <div class="footer-links">
        <p>¬© SW Immobilien | <a href="https://sw-immobilien.de/datenschutz">Datenschutz</a> | <a href="https://sw-immobilien.de/impressum">Impressum</a></p>
    </div>
</div>

<script>
    // Initialisierung EmailJS
    (function(){
        emailjs.init("_xVMakll6CBznjSHE");
    })();

    let currentStep = 0;
    let formData = {
        category: '', subcategory: '',
        living: 120, plot: 500, year: 1995,
        condition: '', quality: '', sanYear: '',
        features: {},
        address: '', lat: null, lon: null,
        results: {}
    };

    const subCats = {
        haus: ["Einfamilienhaus", "Doppelhaus", "Reihenmittelhaus", "Bungalow", "Stadtvilla", "Sonstiges"],
        wohnung: ["Etagenwohnung", "Erdgeschosswohnung", "Dachgeschosswohnung", "Penthouse", "Sonstiges"],
        gewerbe: ["Ladenlokal", "Halle", "B√ºrofl√§chen", "Sonstiges"],
        grundstueck: ["Erschlossen", "Mit Abrissimmobilie", "Frei / Unerschlossen"]
    };

    const features = ["Garage", "Stellplatz", "Pool", "Einliegerwohnung", "Sauna", "G√§ste-WC", "Keller", "Balkon", "Terrasse"];

    function nextStep(s) {
        document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
        document.getElementById('step' + (s === 'Intro' ? 'Intro' : s)).classList.add('active');
        currentStep = s;
        updateProgress();
        window.scrollTo(0,0);
    }

    function prevStep() {
        if(currentStep > 1) nextStep(currentStep - 1);
        else nextStep('Intro');
    }

    function updateProgress() {
        let percent = (currentStep / 7) * 100;
        document.getElementById('progressFill').style.width = percent + '%';
    }

    function selectCat(cat, icon) {
        formData.category = cat;
        const grid = document.getElementById('subCatGrid');
        grid.innerHTML = '';
        subCats[cat].forEach(s => {
            let div = document.createElement('div');
            div.className = 'card-option';
            div.innerText = s;
            div.onclick = () => { 
                formData.subcategory = s; 
                if(cat === 'gewerbe' || cat === 'grundstueck') {
                    document.getElementById('plot_group').style.display = (cat === 'grundstueck') ? 'block' : 'none';
                    nextStep(2); // √úberspringe Zustand/Ausstattung bei Grundst√ºcken? Optional anpassbar
                } else {
                    nextStep(2);
                }
            };
            grid.appendChild(div);
        });
        document.getElementById('subCatWrapper').classList.remove('hidden');
    }

    function sync(type) {
        let val = document.getElementById('range_' + type).value;
        document.getElementById('num_' + type).value = val;
        document.getElementById('val_' + type).innerText = val;
        formData[type] = parseInt(val);
    }

    function setCondition(cond, el) {
        formData.condition = cond;
        document.querySelectorAll('#step3 .card-option').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        document.getElementById('sanierungYear').classList.toggle('hidden', cond !== 'Saniert');
    }

    function setQuality(q, el) {
        formData.quality = q;
        document.querySelectorAll('#step4 .card-option').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
    }

    // Features mit Multi-Click
    function initFeatures() {
        const grid = document.getElementById('featureGrid');
        features.forEach(f => {
            let div = document.createElement('div');
            div.className = 'card-option';
            div.innerHTML = f;
            div.onclick = () => {
                formData.features[f] = (formData.features[f] || 0) + 1;
                if(formData.features[f] > 5) formData.features[f] = 0; // Reset nach 5
                updateFeatureUI(div, f);
            };
            grid.appendChild(div);
        });
    }

    function updateFeatureUI(el, f) {
        let count = formData.features[f];
        let badge = el.querySelector('.badge');
        if(count > 0) {
            el.classList.add('selected');
            if(!badge) {
                badge = document.createElement('div');
                badge.className = 'badge';
                el.appendChild(badge);
            }
            badge.innerText = count;
        } else {
            el.classList.remove('selected');
            if(badge) badge.remove();
        }
    }

    // MAP & ADRESSE
    let map = L.map('map').setView([51.1657, 10.4515], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    let marker = L.marker([51.1657, 10.4515]).addTo(map);

    document.getElementById('address-input').addEventListener('input', function() {
        let q = this.value;
        if(q.length < 5) return;
        fetch(`https://nominatim.openstreetmap.org/search?format=json&limit=5&q=${q}&countrycodes=de`)
            .then(r => r.json()).then(data => {
                let res = document.getElementById('autocomplete-results');
                res.innerHTML = '';
                data.forEach(p => {
                    let d = document.createElement('div');
                    d.style.padding = '10px'; d.style.cursor = 'pointer';
                    d.innerText = p.display_name;
                    d.onclick = () => {
                        formData.address = p.display_name;
                        formData.lat = p.lat; formData.lon = p.lon;
                        document.getElementById('address-input').value = p.display_name;
                        marker.setLatLng([p.lat, p.lon]);
                        map.setView([p.lat, p.lon], 16);
                        res.innerHTML = '';
                    };
                    res.appendChild(d);
                });
            });
    });

    // BERECHNUNG & TEIL-LEAD
    function calculate() {
        // Stark vereinfachte Logik basierend auf BORIS-Prinzipien
        let basePrice = 2800; // Durchschnittlicher QM Preis Pfalz
        let regionalFactor = 1.0; 
        
        // Simulierter Algorithmus
        let wertVergleich = formData.living * basePrice * regionalFactor;
        if(formData.quality === 'Luxus') wertVergleich *= 1.3;
        if(formData.condition === 'Renovierungsbed√ºrftig') wertVergleich *= 0.7;

        let wertSach = (formData.living * 1450 * 1.18) + (formData.plot * 150); // NHK 2015 Simulation
        
        formData.results = {
            vergleich: wertVergleich,
            sachwert: wertSach,
            avg: (wertVergleich + wertSach) / 2
        };

        document.getElementById('res_range').innerText = 
            (Math.round(formData.results.avg * 0.95 / 1000) * 1000).toLocaleString() + " ‚Ç¨ - " + 
            (Math.round(formData.results.avg * 1.08 / 1000) * 1000).toLocaleString() + " ‚Ç¨";
        
        document.getElementById('res_vergleich').innerText = Math.round(wertVergleich).toLocaleString() + " ‚Ç¨";
        document.getElementById('res_sachwert').innerText = Math.round(wertSach).toLocaleString() + " ‚Ç¨";
    }

    function confirmAddress() {
        if(!formData.address) { alert("Bitte Adresse w√§hlen"); return; }
        calculate();
        
        // Teil-Lead via EmailJS
        emailjs.send("service_9wal0zr", "template_bwjdkei", {
            address: formData.address,
            estimated_value: document.getElementById('res_range').innerText,
            info: `Typ: ${formData.subcategory}, Fl√§che: ${formData.living}qm`
        });
        
        nextStep(7);
    }

    function sendFinal() {
        let name = document.getElementById('f_name').value;
        let email = document.getElementById('f_email').value;
        if(!name || !email) { alert("Bitte Name und E-Mail angeben"); return; }

        emailjs.send("service_9wal0zr", "template_bwjdkei", {
            from_name: name,
            user_email: email,
            user_phone: document.getElementById('f_phone').value,
            address: formData.address,
            estimated_value: document.getElementById('res_range').innerText,
            details: JSON.stringify(formData)
        }).then(() => {
            alert("Vielen Dank! Wir haben Ihre Daten erhalten und bereiten die Detailanalyse vor.");
        });
    }

    function openCalendly() {
        window.open("https://calendly.com/d-will-sw-immobilien/strategische-ersteinschatzung-verkauf", "_blank");
    }

    initFeatures();
</script>
<script type="text/javascript" src="https://assets.calendly.com/assets/external/widget.js" async></script>
</body>
</html>